import{r,j as e,s as S}from"./index-ByQWjG9P.js";import{H as j,I as h,J as k,K as I}from"./index.esm-Bscq3nrx.js";const P=()=>{const[o,a]=r.useState(""),[n,c]=r.useState(!1),[u,b]=r.useState(null),[m,g]=r.useState(!1),f=`
-- 1. Create the movies table if it doesn't exist
create table if not exists public.movies (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 2. Add columns if they don't exist (Idempotent)
do $$
begin
  -- Text fields (Basic Info)
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'title') then
    alter table public.movies add column title text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'description') then
    alter table public.movies add column description text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'category') then
    alter table public.movies add column category text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'frontImage') then
    alter table public.movies add column "frontImage" text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'backImage') then
    alter table public.movies add column "backImage" text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'certification') then
    alter table public.movies add column certification text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'backImage') then
    alter table public.movies add column "backImage" text;
  end if;
  -- Phase 7: Carousel specific image
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'carouselImage') then
    alter table public.movies add column "carouselImage" text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'watchLink') then
    alter table public.movies add column "watchLink" text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'language') then
    alter table public.movies add column language text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'country') then
    alter table public.movies add column country text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'releaseDate') then
    alter table public.movies add column "releaseDate" text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'director') then
    alter table public.movies add column director text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'updated_at') then
    alter table public.movies add column updated_at timestamp with time zone default timezone('utc'::text, now()) not null;
  end if;

  -- Phase 2 New Columns: Type & Status
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'type') then
       alter table public.movies add column type text default 'movie'; -- 'movie' or 'series'
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'status') then
       alter table public.movies add column status text default 'published'; -- 'published' or 'draft'
  end if;

  -- Numeric/Boolean fields
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'year') then
    alter table public.movies add column year integer;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'rating') then
    alter table public.movies add column rating numeric;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'top10') then
    alter table public.movies add column "top10" boolean default false;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'isNewRelease') then
    alter table public.movies add column "isNewRelease" boolean default false;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'isPopular') then
    alter table public.movies add column "isPopular" boolean default false;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'featured') then
    alter table public.movies add column featured boolean default false;
  end if;

  -- JSONB fields
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'cast') then
    alter table public.movies add column "cast" jsonb;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'writers') then
    alter table public.movies add column writers jsonb;
  end if;
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'awards') then
    alter table public.movies add column awards jsonb;
  end if;
  -- Phase 2 New Columns: Series Support
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'seasons') then
    alter table public.movies add column seasons jsonb; -- Detailed season/episode data
  end if;
  
  -- Phase 6: Top 10 Ordering
  if not exists (select 1 from information_schema.columns where table_name = 'movies' and column_name = 'top10_order') then
    alter table public.movies add column "top10_order" integer default 0;
  end if;
end $$;

-- 3. Create Homepage Config Table (Phase 2)
create table if not exists public.homepage_config (
    id bigint generated by default as identity primary key,
    key text unique not null,
    value jsonb not null,
    updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 4. Enable RLS and Policies
alter table public.movies enable row level security;
alter table public.homepage_config enable row level security;

-- Policy for Public Read Access (Movies)
do $$
begin
  if not exists (select 1 from pg_policies where tablename = 'movies' and policyname = 'Allow public read access') then
    create policy "Allow public read access" on public.movies for select to anon using (true);
  end if;
end $$;

-- Policy for Public Read Access (Config)
do $$
begin
  if not exists (select 1 from pg_policies where tablename = 'homepage_config' and policyname = 'Allow public read access config') then
    create policy "Allow public read access config" on public.homepage_config for select to anon using (true);
  end if;
end $$;

-- Policy for Insert/Update (Dev Mode - should restrict to authenticated users in prod)
do $$
begin
  if not exists (select 1 from pg_policies where tablename = 'movies' and policyname = 'Allow anon insert/update') then
    create policy "Allow anon insert/update" on public.movies for all to anon using (true) with check (true);
  end if;
  if not exists (select 1 from pg_policies where tablename = 'movies' and policyname = 'Allow authenticated full access') then
    create policy "Allow authenticated full access" on public.movies for all to authenticated using (true) with check (true);
  end if;

    if not exists (select 1 from pg_policies where tablename = 'homepage_config' and policyname = 'Allow anon insert/update config') then
    create policy "Allow anon insert/update config" on public.homepage_config for all to anon using (true) with check (true);
  end if;
  if not exists (select 1 from pg_policies where tablename = 'homepage_config' and policyname = 'Allow authenticated full access config') then
    create policy "Allow authenticated full access config" on public.homepage_config for all to authenticated using (true) with check (true);
  end if;
end $$;
`,x=i=>{b(i.target.files[0])},_=()=>{navigator.clipboard.writeText(f),alert("SQL copied to clipboard! Paste it in Supabase SQL Editor.")},w=async()=>{if(!u){a("Please select a JSON file first.");return}c(!0),a("Reading file...");const i=new FileReader;i.onload=async v=>{try{const s=v.target.result,d=JSON.parse(s),l=d.movies||(Array.isArray(d)?d:[]);if(l.length===0){a("Error: No movies found in JSON."),c(!1);return}a(`Found ${l.length} movies. Uploading to Supabase...`);const y=l.map(t=>({id:t.id,title:t.title,year:t.year,rating:t.rating,category:t.category,description:t.description,frontImage:t.frontImage,backImage:t.backImage,certification:t.certification,duration:t.duration,watchLink:t.watchLink,top10:t.top10,isNewRelease:t.isNewRelease,isPopular:t.isPopular,director:t.director,writers:t.writers,cast:t.cast,awards:t.awards,language:t.language,country:t.country,releaseDate:t.releaseDate,featured:t.featured})),{error:p}=await S.from("movies").upsert(y,{onConflict:"id",ignoreDuplicates:!1});if(p)throw p;a(`Success! Uploaded/Updated ${l.length} movies.`)}catch(s){console.error("Upload error:",s),a(`Error: ${s.message}`)}finally{c(!1)}},i.readAsText(u)};return e.jsxs("div",{style:{padding:"2rem",maxWidth:"800px",margin:"0 auto",minHeight:"80vh"},children:[e.jsx("h1",{style:{marginBottom:"2rem",color:"#03c76c"},children:"Admin Dashboard Tool"}),e.jsxs("div",{style:{background:"white",padding:"2rem",borderRadius:"15px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)",marginBottom:"2rem"},children:[e.jsxs("h2",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"10px",color:"#333"},children:[e.jsx(j,{})," 1. Database Setup"]}),e.jsxs("p",{style:{marginBottom:"1rem",color:"#666"},children:["Copy the SQL below and run it in the ",e.jsx("a",{href:"https://supabase.com/dashboard/project/_/sql",target:"_blank",rel:"noreferrer",style:{color:"#03c76c"},children:"Supabase SQL Editor"}),"."]}),e.jsx("button",{onClick:()=>g(!m),style:{background:"#f8f9fa",border:"1px solid #ddd",padding:"0.5rem 1rem",borderRadius:"5px",cursor:"pointer",marginBottom:"1rem"},children:m?"Hide SQL Script":"Show SQL Script"}),m&&e.jsxs("div",{style:{position:"relative"},children:[e.jsx("pre",{style:{background:"#1e1e1e",color:"#d4d4d4",padding:"1rem",borderRadius:"8px",overflowX:"auto",fontSize:"0.9rem"},children:f}),e.jsx("button",{onClick:_,style:{position:"absolute",top:"10px",right:"10px",background:"#03c76c",color:"white",border:"none",padding:"0.3rem 0.8rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.8rem"},children:"Copy"})]})]}),e.jsxs("div",{style:{background:"white",padding:"2rem",borderRadius:"15px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)"},children:[e.jsxs("h2",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(h,{})," 2. Upload Data"]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsxs("p",{style:{marginBottom:"1rem",color:"#555"},children:["Upload your ",e.jsx("code",{children:"movies.json"})," file here to populate the Supabase database."]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[e.jsx("input",{type:"file",accept:".json",onChange:x,style:{padding:"0.5rem"}}),e.jsx("button",{onClick:w,disabled:n,style:{background:n?"#ccc":"linear-gradient(135deg, #03c76c, #d3f57f)",color:"white",border:"none",padding:"0.8rem 1.5rem",borderRadius:"50px",fontWeight:"bold",cursor:n?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:n?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(h,{})," Upload to Database"]})})]})]}),o&&e.jsxs("div",{style:{padding:"1rem",borderRadius:"8px",background:o.includes("Error")?"#ffebee":"#e8f5e9",color:o.includes("Error")?"#c62828":"#2e7d32",marginTop:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.includes("Error")?e.jsx(k,{}):e.jsx(I,{}),o]})]})]})};export{P as default};
